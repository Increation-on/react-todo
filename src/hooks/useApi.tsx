// –ò–º–ø–æ—Ä—Ç—ã –∏–∑ React
import { useState } from "react"
import React from "react"

// üîπ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ß–¢–û –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö—É–∫
// <T> –æ–∑–Ω–∞—á–∞–µ—Ç "—Ç–∏–ø–æ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä" - —Ö—É–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –õ–Æ–ë–´–ú —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
interface ApiReturn<T> {
    isLoading: boolean                    // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏: true/false
    setIsLoading: React.Dispatch<React.SetStateAction<boolean>>,  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è isLoading
    error: string | null                 // –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ—Ç –æ—à–∏–±–∫–∏
    setError: React.Dispatch<React.SetStateAction<string | null>> // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è error
    fetchWithState: (url: string) => Promise<T>,  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise —Å —Ç–∏–ø–æ–º T
}

// üîπ –°–æ–∑–¥–∞—ë–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ useApi
// <T,> –∑–∞–ø—è—Ç–∞—è –Ω—É–∂–Ω–∞ –¥–ª—è TSX —Ñ–∞–π–ª–æ–≤ —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç JSX —Ç–µ–≥–æ–≤
// : ApiReturn<T> —É–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ ApiReturn
export const useApi = <T,>(): ApiReturn<T> => { // –∑–∞–ø—è—Ç–∞—è –ø–æ—Å–ª–µ T - —É–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç jsx –∏ tsx
    // üîπ –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    // useState<boolean> - —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const [isLoading, setIsLoading] = useState<boolean>(false)

    // üîπ –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫
    // string | null - –æ—à–∏–±–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å (null)
    const [error, setError] = useState<string | null>(null)

    // üîπ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
    // url: string - –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
    // : Promise<T> - —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞ T
    const fetchWithState = async (url: string): Promise<T> => {
        // –ü–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º: –≤–∫–ª—é—á–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
        setIsLoading(true)
        setError(null)
        console.log('Start loading')

        try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º HTTP –∑–∞–ø—Ä–æ—Å
            const response = await fetch(url)

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ (200-299 = —É—Å–ø–µ—Ö)
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')

            // –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
            const result = await response.json()
            console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', result)

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç - TypeScript —Å—á–∏—Ç–∞–µ—Ç —á—Ç–æ —ç—Ç–æ —Ç–∏–ø T
            return result

        } catch (error) {
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            // –í TypeScript error –∏–º–µ–µ—Ç —Ç–∏–ø unknown, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
            const errorMessage = error instanceof Error ? error.message : 'Unknown error'
            setError(errorMessage)
            console.log('–û—à–∏–±–∫–∞:', error)
            
            // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–º –∫–æ–¥–µ
            throw error
        } finally {
            // –í—ã–∫–ª—é—á–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤ –õ–Æ–ë–û–ú —Å–ª—É—á–∞–µ (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
            setIsLoading(false)
        }
    }

    // üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
    return { isLoading, setIsLoading, error, setError, fetchWithState }
}

//  –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
// <T,> ‚Äî –¥–∂–µ–Ω–µ—Ä–∏–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª—é–±—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

// Promise<T> ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise —Å –Ω–∞—à–∏–º —Ç–∏–ø–æ–º T

// string | null ‚Äî —Ç–∏–ø "–∏–ª–∏ —Å—Ç—Ä–æ–∫–∞, –∏–ª–∏ null"

// React.Dispatch<...> ‚Äî —Ç–∏–ø —Ñ—É–Ω–∫—Ü–∏–π setState

// error instanceof Error ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ –≤ catch